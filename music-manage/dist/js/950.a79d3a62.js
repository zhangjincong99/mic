"use strict";(self["webpackChunkmusic_manage"]=self["webpackChunkmusic_manage"]||[]).push([[950],{179:function(e,t,n){n.d(t,{JO:function(){return a},c6:function(){return l},wC:function(){return o}});var a;(function(e){e["BOFANG"]="#icon-bofanganniu",e["ZANTING"]="#icon-zanting"})(a||(a={}));const l="Yin-music 后台管理";var o;(function(e){e["Home"]="/home",e["Info"]="/info",e["Song"]="/song",e["Singer"]="/singer",e["SongList"]="/songList",e["ListSong"]="/listSong",e["Comment"]="/Comment",e["Consumer"]="/consumer",e["Collect"]="/collect",e["Error"]="/404",e["SignIn"]="/",e["SignOut"]="0"})(o||(o={}))},8045:function(e,t,n){n.d(t,{Z:function(){return i}});n(7658);var a=n(3396),l=n(4870),o=n(179);function i(){const{proxy:e}=(0,a.FN)(),t=(0,l.iH)(["jpg","jpeg","png","gif"]);function n(e){return 0===e?"女":1===e?"男":2===e?"组合":3===e?"不明":"男"===e||"女"===e?e:void 0}function i(n){const a=2,l=n.size/1024/1024<a,o=t.value.includes(n.type.replace(/image\//,""));return o||e.$message.error(`图片只支持 ${t.value.join("、")} 格式!`),l||e.$message.error(`上传头像图片大小不能超过 ${a}MB!`),o&&l}function r(t){const n=10,a=t.size/1024/1024<n,l=t.name.substring(t.name.lastIndexOf(".")+1),o="mp3"===l;return o||e.$message({message:"上传文件只能是mp3格式！",type:"error"}),a||e.$message.error(`上传头像图片大小不能超过 ${n}MB!`),o&&a}function u(t,n){switch(t){case o.wC.Song:case o.wC.ListSong:case o.wC.Comment:case o.wC.Consumer:case o.wC.Collect:e.$router.push({path:n.path,query:n.query});break;case o.wC.Home:case o.wC.SignIn:case o.wC.SignOut:case o.wC.Info:case o.wC.Singer:case o.wC.SongList:case o.wC.Error:default:e.$router.push({path:n.path});break}}function s(t=-1){e.$router.go(t)}return{changeSex:n,routerManager:u,goBack:s,beforeImgUpload:i,beforeSongUpload:r}}},2024:function(e,t,n){n.d(t,{o:function(){return a},z:function(){return l}});n(7658);function a(e){if(null==e||""==e)return"";const t=new Date(e),n=t.getFullYear(),a=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,l=t.getDate()<10?"0"+t.getDate():t.getDate();return n+"-"+a+"-"+l}function l(e){const t=e.split("\n"),n=/\[\d{2}:\d{2}.(\d{3}|\d{2})\]/g,a=[];if(!/\[.+\]/.test(e))return[e];for(const l of t)if(n.test(l)){const e=l.replace(n,"");a.push(e)}return a}},8968:function(e,t,n){n.d(t,{Z:function(){return d}});var a=n(3396);const l=(0,a._)("div",{class:"del-dialog-cnt",align:"center"},"删除不可恢复，是否确定删除？",-1),o={class:"dialog-footer"};function i(e,t,n,i,r,u){const s=(0,a.up)("el-button"),c=(0,a.up)("el-dialog");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a.Wm)(c,{title:"提示",modelValue:e.centerDialogVisible,"onUpdate:modelValue":t[0]||(t[0]=t=>e.centerDialogVisible=t),width:"300px",center:""},{footer:(0,a.w5)((()=>[(0,a._)("span",o,[(0,a.Wm)(s,{onClick:e.cancelRow},{default:(0,a.w5)((()=>[(0,a.Uk)("取 消")])),_:1},8,["onClick"]),(0,a.Wm)(s,{type:"primary",onClick:e.confirm},{default:(0,a.w5)((()=>[(0,a.Uk)("确 定")])),_:1},8,["onClick"])])])),default:(0,a.w5)((()=>[l])),_:1},8,["modelValue"])])}var r=n(4870),u=(0,a.aZ)({props:{delVisible:Boolean},emits:["cancelRow","confirm"],setup(e){const{proxy:t}=(0,a.FN)(),{delVisible:n}=(0,r.BK)(e),l=(0,r.iH)(n.value);function o(){t.$emit("cancelRow",!1)}function i(){t.$emit("confirm",null)}return(0,a.YP)(n,(e=>{l.value=e})),{centerDialogVisible:l,cancelRow:o,confirm:i}}}),s=n(89);const c=(0,s.Z)(u,[["render",i]]);var d=c},950:function(e,t,n){n.r(t),n.d(t,{default:function(){return F}});var a=n(3396),l=n(7139);const o=e=>((0,a.dD)("data-v-e4f49e14"),e=e(),(0,a.Cn)(),e),i={class:"container"},r={class:"handle-box"},u={style:{width:"80px",height:"80px",overflow:"hidden"}},s=["src"],c=["onClick"],d={class:"icon","aria-hidden":"true"},m=["xlink:href"],g={style:{height:"100px",overflow:"scroll"}},p=o((()=>(0,a._)("br",null,null,-1))),f=o((()=>(0,a._)("input",{type:"file",name:"file"},null,-1))),w={class:"dialog-footer"},y={class:"dialog-footer"};function b(e,t,n,o,b,h){const v=(0,a.up)("el-breadcrumb-item"),C=(0,a.up)("el-breadcrumb"),_=(0,a.up)("el-button"),W=(0,a.up)("el-input"),S=(0,a.up)("el-table-column"),V=(0,a.up)("el-upload"),k=(0,a.up)("el-table"),U=(0,a.up)("el-pagination"),I=(0,a.up)("el-form-item"),F=(0,a.up)("el-form"),x=(0,a.up)("el-dialog"),D=(0,a.up)("yin-del-dialog");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(C,{class:"crumbs",separator:"/"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.breadcrumbList,(e=>((0,a.wg)(),(0,a.j4)(v,{key:e.name,to:{path:e.path,query:e.query}},{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(e.name),1)])),_:2},1032,["to"])))),128))])),_:1}),(0,a._)("div",i,[(0,a._)("div",r,[(0,a.Wm)(_,{onClick:e.deleteAll},{default:(0,a.w5)((()=>[(0,a.Uk)("批量删除")])),_:1},8,["onClick"]),(0,a.Wm)(W,{modelValue:e.searchWord,"onUpdate:modelValue":t[0]||(t[0]=t=>e.searchWord=t),placeholder:"筛选关键词"},null,8,["modelValue"]),(0,a.Wm)(_,{type:"primary",onClick:t[1]||(t[1]=t=>e.centerDialogVisible=!0)},{default:(0,a.w5)((()=>[(0,a.Uk)("添加歌曲")])),_:1})]),(0,a.Wm)(k,{height:"550px",border:"",size:"small",data:e.data,onSelectionChange:e.handleSelectionChange},{default:(0,a.w5)((()=>[(0,a.Wm)(S,{type:"selection",width:"40"}),(0,a.Wm)(S,{label:"ID",prop:"id",width:"50",align:"center"}),(0,a.Wm)(S,{label:"歌手图片",width:"110",align:"center"},{default:(0,a.w5)((t=>[(0,a._)("div",u,[(0,a._)("img",{src:e.attachImageUrl(t.row.pic),style:{width:"100%"}},null,8,s)]),(0,a._)("div",{class:"play",onClick:n=>e.setSongUrl(t.row)},[((0,a.wg)(),(0,a.iD)("svg",d,[(0,a._)("use",{"xlink:href":e.toggle===t.row.name?e.playIcon:e.BOFANG},null,8,m)]))],8,c)])),_:1}),(0,a.Wm)(S,{label:"歌名",prop:"name",width:"150"}),(0,a.Wm)(S,{label:"专辑",prop:"introduction",width:"150"}),(0,a.Wm)(S,{label:"歌词",align:"center"},{default:(0,a.w5)((t=>[(0,a._)("ul",g,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.parseLyric(t.row.lyric),((e,t)=>((0,a.wg)(),(0,a.iD)("li",{key:t},(0,l.zw)(e),1)))),128))])])),_:1}),(0,a.Wm)(S,{label:"资源更新",width:"120",align:"center"},{default:(0,a.w5)((t=>[(0,a.Wm)(V,{action:e.updateSongImg(t.row.id),"show-file-list":!1,"on-success":e.handleImgSuccess,"before-upload":e.beforeImgUpload},{default:(0,a.w5)((()=>[(0,a.Wm)(_,null,{default:(0,a.w5)((()=>[(0,a.Uk)("更新图片")])),_:1})])),_:2},1032,["action","on-success","before-upload"]),p,(0,a.Wm)(V,{action:e.updateSongUrl(t.row.id),"show-file-list":!1,"on-success":e.handleSongSuccess,"before-upload":e.beforeSongUpload},{default:(0,a.w5)((()=>[(0,a.Wm)(_,null,{default:(0,a.w5)((()=>[(0,a.Uk)("更新歌曲")])),_:1})])),_:2},1032,["action","on-success","before-upload"])])),_:1}),(0,a.Wm)(S,{label:"评论",width:"90",align:"center"},{default:(0,a.w5)((t=>[(0,a.Wm)(_,{onClick:n=>e.goCommentPage(t.row.id)},{default:(0,a.w5)((()=>[(0,a.Uk)("评论")])),_:2},1032,["onClick"])])),_:1}),(0,a.Wm)(S,{label:"操作",width:"160",align:"center"},{default:(0,a.w5)((t=>[(0,a.Wm)(_,{onClick:n=>e.editRow(t.row)},{default:(0,a.w5)((()=>[(0,a.Uk)("编辑")])),_:2},1032,["onClick"]),(0,a.Wm)(_,{type:"danger",onClick:n=>e.deleteRow(t.row.id)},{default:(0,a.w5)((()=>[(0,a.Uk)("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","onSelectionChange"]),(0,a.Wm)(U,{class:"pagination",background:"",layout:"total, prev, pager, next","current-page":e.currentPage,"page-size":e.pageSize,total:e.tableData.length,onCurrentChange:e.handleCurrentChange},null,8,["current-page","page-size","total","onCurrentChange"])]),(0,a.Wm)(x,{title:"添加歌曲",modelValue:e.centerDialogVisible,"onUpdate:modelValue":t[6]||(t[6]=t=>e.centerDialogVisible=t)},{footer:(0,a.w5)((()=>[(0,a._)("span",w,[(0,a.Wm)(_,{onClick:t[5]||(t[5]=t=>e.centerDialogVisible=!1)},{default:(0,a.w5)((()=>[(0,a.Uk)("取 消")])),_:1}),(0,a.Wm)(_,{type:"primary",onClick:e.addSong},{default:(0,a.w5)((()=>[(0,a.Uk)("确 定")])),_:1},8,["onClick"])])])),default:(0,a.w5)((()=>[(0,a.Wm)(F,{id:"add-song","label-width":"120px",model:e.registerForm},{default:(0,a.w5)((()=>[(0,a.Wm)(I,{label:"歌曲名"},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{type:"text",name:"name",modelValue:e.registerForm.name,"onUpdate:modelValue":t[2]||(t[2]=t=>e.registerForm.name=t)},null,8,["modelValue"])])),_:1}),(0,a.Wm)(I,{label:"专辑"},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{type:"text",name:"introduction",modelValue:e.registerForm.introduction,"onUpdate:modelValue":t[3]||(t[3]=t=>e.registerForm.introduction=t)},null,8,["modelValue"])])),_:1}),(0,a.Wm)(I,{label:"歌词"},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{type:"textarea",name:"lyric",modelValue:e.registerForm.lyric,"onUpdate:modelValue":t[4]||(t[4]=t=>e.registerForm.lyric=t)},null,8,["modelValue"])])),_:1}),(0,a.Wm)(I,{label:"歌曲上传"},{default:(0,a.w5)((()=>[f])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),(0,a.Wm)(x,{title:"编辑",modelValue:e.editVisible,"onUpdate:modelValue":t[11]||(t[11]=t=>e.editVisible=t)},{footer:(0,a.w5)((()=>[(0,a._)("span",y,[(0,a.Wm)(_,{onClick:t[10]||(t[10]=t=>e.editVisible=!1)},{default:(0,a.w5)((()=>[(0,a.Uk)("取 消")])),_:1}),(0,a.Wm)(_,{type:"primary",onClick:e.saveEdit},{default:(0,a.w5)((()=>[(0,a.Uk)("确 定")])),_:1},8,["onClick"])])])),default:(0,a.w5)((()=>[(0,a.Wm)(F,{model:e.editForm},{default:(0,a.w5)((()=>[(0,a.Wm)(I,{label:"歌曲"},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{modelValue:e.editForm.name,"onUpdate:modelValue":t[7]||(t[7]=t=>e.editForm.name=t)},null,8,["modelValue"])])),_:1}),(0,a.Wm)(I,{label:"简介"},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{modelValue:e.editForm.introduction,"onUpdate:modelValue":t[8]||(t[8]=t=>e.editForm.introduction=t)},null,8,["modelValue"])])),_:1}),(0,a.Wm)(I,{label:"歌词"},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{type:"textarea",modelValue:e.editForm.lyric,"onUpdate:modelValue":t[9]||(t[9]=t=>e.editForm.lyric=t)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),(0,a.Wm)(D,{delVisible:e.delVisible,onConfirm:e.confirm,onCancelRow:t[12]||(t[12]=t=>e.delVisible=t)},null,8,["delVisible","onConfirm"])],64)}n(7658),n(2062);var h=n(4870),v=n(65),C=n(8045),_=n(179),W=n(2167),S=n(2024),V=n(8968),k=(0,a.aZ)({components:{YinDelDialog:V.Z},setup(){const{proxy:e}=(0,a.FN)(),{routerManager:t,beforeImgUpload:n,beforeSongUpload:l}=(0,C.Z)(),o=(0,v.oR)(),i=(0,h.iH)([]),r=(0,h.iH)([]),u=(0,h.iH)(5),s=(0,h.iH)(1),c=(0,h.iH)(""),d=(0,h.iH)(""),m=(0,h.iH)(!1),g=(0,h.iH)(_.JO.BOFANG),p=(0,h.iH)(_.JO.ZANTING),f=(0,a.Fl)((()=>o.getters.breadcrumbList)),w=(0,a.Fl)((()=>o.getters.isPlay)),y=(0,a.Fl)((()=>w.value?p.value:g.value)),b=(0,a.Fl)((()=>i.value.slice((s.value-1)*u.value,s.value*u.value))),V=(0,h.iH)("");async function k(){i.value=[],r.value=[];const e=await W.x.getSongOfSingerId(c.value);i.value=e.data,r.value=e.data,s.value=1}function U(t){e.$store.commit("setUrl",t.url),m.value=t.name,w.value?e.$store.commit("setIsPlay",!1):e.$store.commit("setIsPlay",!0)}function I(e){return W.x.updateSongImg(e)}function F(e){return W.x.updateSongUrl(e)}function x(e){s.value=e}function D(t){e.$message({message:t.message,type:t.type}),t.success&&k()}function $(t,n){e.$message({message:t.message,type:t.type}),t.success&&k()}function H(n){const a=(0,h.qj)([{path:_.wC.Singer,name:"歌手管理"},{path:_.wC.Song,query:{id:c.value,name:d.value},name:"歌曲信息"},{path:"",name:"评论详情"}]);e.$store.commit("setBreadcrumbList",a),t(_.wC.Comment,{path:_.wC.Comment,query:{id:n,type:0}})}(0,a.YP)(V,(()=>{if(""===V.value)i.value=r.value;else{i.value=[];for(let e of r.value)e.name.includes(V.value)&&i.value.push(e)}})),c.value=e.$route.query.id,d.value=e.$route.query.name,e.$store.commit("setIsPlay",!1),k();const N=(0,h.iH)(!1),L=(0,h.qj)({name:"",singerName:"",introduction:"",lyric:""});function q(){const t=new FormData(document.getElementById("add-song"));t.append("singerId",c.value),t.set("name",d.value+"-"+t.get("name")),t.get("lyric")||t.set("lyric","[00:00:00]暂无歌词");const n=new XMLHttpRequest;n.onreadystatechange=()=>{if(4===n.readyState&&200===n.status){let t=JSON.parse(n.response);e.$message({message:t.message,type:t.type}),t.success&&(k(),L.name="",L.singerName="",L.introduction="",L.lyric="")}},n.open("post",W.x.attachImageUrl("/song/add"),!1),n.send(t),N.value=!1}const z=(0,h.iH)(!1),O=(0,h.qj)({id:"",singerId:"",name:"",introduction:"",createTime:"",updateTime:"",pic:"",lyric:"",url:""});function R(e){P.value=e.id,O.id=e.id,O.singerId=e.singerId,O.name=e.name,O.introduction=e.introduction,O.createTime=e.createTime,O.updateTime=e.updateTime,O.pic=e.pic,O.lyric=e.lyric,O.url=e.url,z.value=!0}async function B(){const t=new URLSearchParams,n=O.name;t.append("id",O.id),t.append("singerId",O.singerId),t.append("name",n),t.append("introduction",O.introduction),t.append("lyric",O.lyric);const a=await W.x.updateSongMsg(t);e.$message({message:a.message,type:a.type}),a.success&&k(),z.value=!1}const P=(0,h.iH)(-1),Z=(0,h.iH)([]),A=(0,h.iH)(!1);async function M(){const t=await W.x.deleteSong(P.value);e.$message({message:t.message,type:t.type}),t.success&&k(),A.value=!1}function T(e){P.value=e,A.value=!0}function Y(e){Z.value=e}function j(){for(let e of Z.value)T(e.id),M();Z.value=[]}return{playIcon:y,toggle:m,searchWord:V,data:b,editForm:O,registerForm:L,tableData:i,centerDialogVisible:N,editVisible:z,delVisible:A,pageSize:u,currentPage:s,ZANTING:p,BOFANG:g,breadcrumbList:f,deleteAll:j,handleSelectionChange:Y,handleCurrentChange:x,handleImgSuccess:$,beforeImgUpload:n,parseLyric:S.z,saveEdit:B,updateSongImg:I,updateSongUrl:F,deleteRow:T,confirm:M,attachImageUrl:W.x.attachImageUrl,addSong:q,editRow:R,handleSongSuccess:D,setSongUrl:U,beforeSongUpload:l,goCommentPage:H}}}),U=n(89);const I=(0,U.Z)(k,[["render",b],["__scopeId","data-v-e4f49e14"]]);var F=I}}]);
//# sourceMappingURL=950.a79d3a62.js.map